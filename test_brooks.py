from brooks import digest_protein, filter_glycopeptides
from pyteomics import fasta

# Test Data  ==================================================================

SPIKE_PROTEIN: str = fasta.read("data/algal_spike.faa").next().sequence
TRYPTIC_PEPTIDES: set[str] = {
    "MAR",
    "TGALLLVALALAGCAQACR",
    "MNLTTR",
    "TQLPPAYTNSFTR",
    "GVYYPDK",
    "VFR",
    "SSVLHSTQDLFLPFFSNVTWFHAIHVSGTNGTK",
    "R",
    "FDNPVLPFNDGVYFASTEK",
    "SNIIR",
    "GWIFGTTLDSK",
    "TQSLLIVNNATNVVIK",
    "VCEFQFCNDPFLGVYYHK",
    "NNK",
    "SWMESEFR",
    "VYSSANNCTFEYVSQPFLMDLEGK",
    "QGNFK",
    "NLR",
    "EFVFK",
    "NIDGYFK",
    "IYSK",
    "HTPINLVR",
    "DLPQGFSALEPLVDLPIGINITR",
    "FQTLLALHR",
    "SYLTPGDSSSGWTAGAAAYYVGYLQPR",
    "TFLLK",
    "YNENGTITDAVDCALDPLSETK",
    "CTLK",
    "SFTVEK",
    "GIYQTSNFR",
    "VQPTESIVR",
    "FPNITNLCPFGEVFNATR",
    "FASVYAWNR",
    "K",
    "R",
    "ISNCVADYSVLYNSASFSTFK",
    "CYGVSPTK",
    "LNDLCFTNVYADSFVIR",
    "GDEVR",
    "QIAPGQTGK",
    "IADYNYK",
    "LPDDFTGCVIAWNSNNLDSK",
    "VGGNYNYLYR",
    "LFR",
    "K",
    "SNLKPFER",
    "DISTEIYQAGSTPCNGVEGFNCYFPLQSYGFQPTNGVGYQPYR",
    "VVVLSFELLHAPATVCGPK",
    "K",
    "STNLVK",
    "NK",
    "CVNFNFNGLTGTGVLTESNK",
    "K",
    "FLPFQQFGR",
    "DIADTTDAVR",
    "DPQTLEILDITPCSFGGVSVITPGTNTSNQVAVLYQDVNCTEVPVAIHADQLTPTWR",
    "VYSTGSNVFQTR",
    "AGCLIGAEHVNNSYECDIPIGAGICASYQTQTNSPGSASSVASQSIIAYTMSLGAENSVAYSNNSIAIPTNFTISVTTEILPVSMTK",
    "TSVDCTMYICGDSTECSNLLLQYGSFCTQLNR",
    "ALTGIAVEQDK",
    "NTQEVFAQVK",
    "QIYK",
    "TPPIK",
    "DFGGFNFSQILPDPSKPSK",
    "R",
    "SFIEDLLFNK",
    "VTLADAGFIK",
    "QYGDCLGDIAAR",
    "DLICAQK",
    "FNGLTVLPPLLTDEMIAQYTSALLAGTITSGWTFGAGAALQIPFAMQMAYR",
    "FNGIGVTQNVLYENQK",
    "LIANQFNSAIGK",
    "IQDSLSSTASALGK",
    "LQDVVNQNAQALNTLVK",
    "QLSSNFGAISSVLNDILSR",
    "LDPPEAEVQIDR",
    "LITGR",
    "LQSLQTYVTQQLIR",
    "AAEIR",
    "ASANLAATK",
    "MSECVLGQSK",
    "R",
    "VDFCGK",
    "GYHLMSFPQSAPHGVVFLHVTYVPAQEK",
    "NFTTAPAICHDGK",
    "AHFPR",
    "EGVFVSNGTHWFVTQR",
    "NFYEPQIITTDNTFVSGNCDVVIGIVNNTVYDPLQPELDSFK",
    "EELDK",
    "YFK",
    "NHTSPDVDLGDISGINASVVNIQK",
    "EIDR",
    "LNEVAK",
    "NLNESLIDLQELGK",
    "YEQYIK",
    "WGSHHHHHHHHSPSPSPSPSPSPSPSPSPSPSPSPSPSPSPSPSPSPSPSPSGYPYDVPDYA",
}
GLYCOPEPTIDES: set[str] = {
    "MNLTTR",
    "SSVLHSTQDLFLPFFSNVTWFHAIHVSGTNGTK",
    "TQSLLIVNNATNVVIK",
    "VYSSANNCTFEYVSQPFLMDLEGK",
    "DLPQGFSALEPLVDLPIGINITR",
    "YNENGTITDAVDCALDPLSETK",
    "FPNITNLCPFGEVFNATR",
    "DPQTLEILDITPCSFGGVSVITPGTNTSNQVAVLYQDVNCTEVPVAIHADQLTPTWR",
    "AGCLIGAEHVNNSYECDIPIGAGICASYQTQTNSPGSASSVASQSIIAYTMSLGAENSVAYSNNSIAIPTNFTISVTTEILPVSMTK",
    "DFGGFNFSQILPDPSKPSK",
    "NFTTAPAICHDGK",
    "EGVFVSNGTHWFVTQR",
    "NFYEPQIITTDNTFVSGNCDVVIGIVNNTVYDPLQPELDSFK",
    "NHTSPDVDLGDISGINASVVNIQK",
    "NLNESLIDLQELGK",
}

# Unit Tests ==================================================================


def test_digest_protein():
    tryptic_peptides = digest_protein(SPIKE_PROTEIN)
    assert len(tryptic_peptides) == 90
    assert tryptic_peptides == TRYPTIC_PEPTIDES


def test_filter_glycopeptides():
    tryptic_peptides = digest_protein(SPIKE_PROTEIN)
    glycopeptides = filter_glycopeptides(tryptic_peptides)
    assert len(glycopeptides) == 15
    assert glycopeptides == GLYCOPEPTIDES
